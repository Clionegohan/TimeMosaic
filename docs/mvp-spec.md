# TimeMosaic - MVP 仕様書

## MVP の目的

最小限の機能で、ローカル Markdown ファイルから歴史イベントを読み込み、複数の年表を並べて比較表示できるアプリケーションを構築する。

## MVP スコープ

### 含まれる機能

1. ✅ **Markdown ファイル読み込み**
2. ✅ **マルチカラム年表表示**（TimeMosaic の核心機能）
3. ✅ **タグ選択による列の追加/削除**
4. ✅ **キーワード検索**
5. ✅ **ファイル自動リロード**

### 含まれない機能（将来版）

- ❌ イベントの追加/編集機能（メモアプリで直接編集）
- ❌ 複数ファイル対応
- ❌ エクスポート機能（PDF、画像など）
- ❌ タイムラインのビジュアル表示（グラフなど）
- ❌ ダークモード
- ❌ 列のドラッグ&ドロップによる並び替え

## 機能詳細

### 1. Markdown ファイル読み込み

**要件:**
- ユーザーがファイルパスを設定ファイル（`.env` など）で指定
- アプリ起動時に指定パスの Markdown ファイルを読み込み
- パースエラーがある場合はコンソールに警告を出力

**実装:**
- Vite のカスタムプラグインで API エンドポイントを追加
- `/api/events` で JSON 形式のイベントリストを返す

### 2. マルチカラム年表表示（核心機能）

**要件:**
- タグを選択すると、そのタグごとに年表の列が表示される
- 例: `#日本` と `#西洋美術` を選択 → 2列並んで表示
- 1つのイベントが複数タグを持つ場合、該当する全ての列に表示される
- 各列は時系列順（古い順または新しい順）に並ぶ
- 列は横スクロール可能

**UI デザイン:**
```
┌────────────────────────────────────────────────────┐
│ TimeMosaic                                         │
│ [検索バー] [並び順▼]                               │
│ タグ選択: [#日本 ×] [#西洋美術 ×] [+ タグを追加]  │
├────────────────┬───────────────────────────────────┤
│   #日本        │   #西洋美術                       │
├────────────────┼───────────────────────────────────┤
│ 1945-08-15     │                                   │
│ 終戦記念日     │                                   │
│ #歴史 #日本    │                                   │
│ [詳細を見る]   │                                   │
├────────────────┼───────────────────────────────────┤
│ 1964           │                                   │
│ 東京オリンピック│                                   │
│ #日本 #スポーツ│                                   │
├────────────────┼───────────────────────────────────┤
│                │ 1889                              │
│                │ エッフェル塔完成                  │
│                │ #西洋美術 #フランス               │
├────────────────┼───────────────────────────────────┤
│ 1970           │ 1970                              │
│ 大阪万博       │ 大阪万博                          │
│ #日本 #西洋美術│ #日本 #西洋美術                   │
│                │ ← 両タグを持つイベントは両列に表示│
└────────────────┴───────────────────────────────────┘
```

**詳細:**
- 各イベントカードには以下を表示:
  - 日付（年のみ、または年月日）
  - タイトル
  - 全タグ（該当列のタグはハイライト）
  - 説明文の冒頭（省略形）
- 「詳細を見る」をクリックで説明文全体をモーダル表示

### 3. タグ選択による列の追加/削除

**要件:**
- 利用可能な全タグのリストを表示
- タグをクリックすると、そのタグの列が追加される
- 選択済みタグの `×` ボタンで列を削除
- 最大列数は制限（3〜5列程度、パフォーマンス考慮）

**実装:**
- タグ一覧はイベントから自動抽出
- 選択状態は React state で管理
- 選択タグ配列をもとに列を動的生成

### 4. キーワード検索

**要件:**
- 検索バーにキーワードを入力
- タイトル、説明文、タグから部分一致で検索
- 検索結果のみを全ての列に表示（列は維持）
- リアルタイムで結果を絞り込み

**実装:**
- フロントエンドで JavaScript の `includes()` で検索
- 検索後も列構造は維持
- 将来的には正規表現や Fuzzy 検索も検討

### 5. ファイル自動リロード

**要件:**
- Markdown ファイルが更新されたら自動でブラウザに反映
- ユーザーが手動でリロードボタンを押す必要がない

**実装:**
- バックエンド: Chokidar でファイル監視
- フロントエンド: WebSocket または polling でデータ再取得
- Vite の HMR (Hot Module Replacement) 機能を活用

## 非機能要件

### パフォーマンス
- 1000 イベントまで快適に動作（目安）
- 初期ロード時間: 1秒以内
- 検索/フィルタのレスポンス: 即座（100ms 以内）
- 列の追加/削除: スムーズなアニメーション

### ユーザビリティ
- シンプルで直感的な UI
- 横スクロールがスムーズ
- レスポンシブデザイン（モバイルでは縦1列に折りたたみ）
- キーボードショートカット（将来版）

### 保守性
- TypeScript による型安全性
- コンポーネントの責務を明確に分離
- テストは手動で実施（自動テストは将来版）

## 開発ステップ

### Phase 1: セットアップ（1日目）
1. Vite + React + TypeScript プロジェクト作成
2. Tailwind CSS セットアップ
3. プロジェクト構造整理

### Phase 2: データ層（2日目）
1. Markdown パーサー実装
2. ファイル読み込み API 実装
3. データモデル定義（TypeScript）

### Phase 3: UI 実装（3-4日目）
1. マルチカラムレイアウトコンポーネント
2. イベントカードコンポーネント
3. タグ選択 UI コンポーネント
4. 検索バーコンポーネント
5. レイアウト・スタイリング

### Phase 4: 列の動的生成ロジック（5日目）
1. 選択タグに基づく列の生成
2. イベントの各列への振り分けロジック
3. 時系列ソート
4. 動作確認

### Phase 5: 自動リロード（6日目）
1. ファイル監視機能実装
2. フロントエンドとの連携
3. 動作確認

### Phase 6: 仕上げ（7日目）
1. エラーハンドリング
2. パフォーマンス最適化
3. README 作成
4. 動作確認・バグ修正

## 成功基準

- [ ] Markdown ファイルからイベントを正しく読み込める
- [ ] 選択したタグごとに列が表示される
- [ ] 複数タグを持つイベントが複数の列に表示される
- [ ] タグの追加/削除が動作する
- [ ] キーワード検索が動作する
- [ ] ファイル更新が自動で反映される
- [ ] 1000 イベントでも快適に動作する
- [ ] 横スクロールがスムーズ

## 技術的リスクと対策

### リスク 1: ファイルアクセスの権限問題
- **対策**: 最初にサンプルファイルで動作確認

### リスク 2: パフォーマンス劣化（列が多い場合）
- **対策**: 仮想スクロール導入、列数制限、データキャッシュ

### リスク 3: Markdown パースの複雑さ
- **対策**: シンプルな正規表現ベースのパーサーから始める

### リスク 4: レイアウトの複雑さ
- **対策**: CSS Grid または Flexbox で柔軟なレイアウト実装
